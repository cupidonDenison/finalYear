package com.example.cityguide;

import java.util.ArrayList;
import java.util.List;

import org.w3c.dom.Document;

import android.app.ActionBar;
import android.content.Context;
import android.content.Intent;
import android.location.LocationManager;
import android.os.AsyncTask;
import android.os.Bundle;
import android.util.Log;
import android.view.MenuItem;
import android.view.View;
import android.widget.AdapterView;
import android.widget.AdapterView.OnItemClickListener;
import android.widget.ListView;
import android.widget.Toast;

import com.example.cityguide.adapter.CustomList;
import com.example.cityguide.communication.JSONParser;
import com.example.cityguide.entity.Place;
import com.example.cityguide.managerpackage.PlaceResponseManager;

public class MenuActivity extends DrawerActivity {

	ListView menuList;
	static String type;
	private static List<Place> places;
	static LocationManager locationmanger;
	JSONParser parser = new JSONParser();
	static Document mapDoc;
	static Context menuActivityContexr;
	
	private static final String MENU_ACTIIVTY_TAG = "menu_activity_log";

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		// setContentView(R.layout.activity_menu);
		// getActionBar().setDisplayHomeAsUpEnabled(true);
		
		

		Intent i = getIntent();
		type = i.getStringExtra("Type");
		menuActivityContexr = getApplicationContext();

		type= HomeActivity.getType();
		
		locationmanger = (LocationManager) getSystemService(Context.LOCATION_SERVICE);
		
		
		ActionBar ab = getActionBar();
		ab.setTitle(type);

	//	Log.i("response type", type);
		menuList = (ListView) findViewById(R.id.listView1);
		
		places = getAllPlaces();
		
		Log.d(MENU_ACTIIVTY_TAG, "\nMenu Activity places: \n: "+places.toString());
		menuList.setAdapter(new CustomList(MenuActivity.this, places,locationmanger));
		
		menuList.setOnItemClickListener(new OnItemClickListener() {
			@Override
			public void onItemClick(AdapterView<?> a, View v, int position,
					long id) {
				Object o = menuList.getItemAtPosition(position);
				Place obj_itemDetails = (Place) o;
				Toast.makeText(
						MenuActivity.this,
						"You have chosen : " + " "
								+ obj_itemDetails.getName(),
						Toast.LENGTH_LONG).show();

				Intent intent = new Intent(MenuActivity.this,
						MenuDetailsActivity.class);
				startActivity(intent);
				finish();
				
				
			}
		});

		
	}//End onCreate()
	
	public static ArrayList<Place> getAllPlaces() {
		List<Place> sqlitePlaces = new PlaceResponseManager().getAllPlacesFomSqliteDB(menuActivityContexr);
		ArrayList<Place> places = new ArrayList<Place>();
		for(Place p: sqlitePlaces){
			places.add(p);
		}
		
		Log.i(MENU_ACTIIVTY_TAG, "get all Place from sqlite, size: "+places.size());
		Log.w(MENU_ACTIIVTY_TAG, "\nget all Place from sqlite: "+places.toString());
		return  places;

	}
	
	

	@Override
	protected int getLayout() {
		// TODO Auto-generated method stub
		return R.layout.activity_menu;
	}

	

	@Override
	public boolean onOptionsItemSelected(MenuItem item) {
		return super.onOptionsItemSelected(item);
	}
	
	

	
}// end Actiiyt
