package com.example.cityguide;

import java.io.File;
import java.util.ArrayList;

import android.app.Activity;
import android.content.Context;
import android.content.Intent;
import android.location.Location;
import android.location.LocationManager;
import android.os.Bundle;
import android.util.Log;
import android.widget.RelativeLayout;

import com.example.cityguide.callbackinterface.PlaceResponseListener;
import com.example.cityguide.callbackinterface.ProfileImpl;
import com.example.cityguide.callbackinterface.ProfileInterface;
import com.example.cityguide.entity.Place;
import com.example.cityguide.location.MyLocation;
import com.example.cityguide.managerpackage.PlaceResponseManager;
import com.example.cityguide.managerpackage.ProfileManager;
import com.example.cityguide.utils.Utils;

public class SplashScreen extends Activity {

	public static final String SERVER_IP = "http://192.168.1.9/";
	// public static final String SERVER_IP = "http://192.168.1.4/";
	// public static final String SERVER_IP =
	// "http://www.denisonspace.herobo.com/";

	public static Context appcontext;
	// private static int SPLASH_TIME_OUT = 3000;

	public static Location myLocation;
	LocationManager locationManager;
	private final static String SPLASH_TAG = "splash_log";
	static RelativeLayout progressLayout;
	private static ArrayList<Place> allPlaces;

	private static int userStatus = -1;

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_splash_screen);
		getActionBar().hide();

		appcontext = getApplicationContext();

		Log.i(SPLASH_TAG, "Splash screen launch");

		locationManager = (LocationManager) getSystemService(Context.LOCATION_SERVICE);
		myLocation = new MyLocation(this, locationManager).getLocation();

		if (myLocation != null) {
			Log.i(SPLASH_TAG, "latitude: " + myLocation.getLatitude());
		}

		PlaceResponseManager.getPlaces(this, "all",
				new PlaceResponseListener() {

					@Override
					public void getPlace(ArrayList<Place> response) {

						try {
							findViewById(R.id.loadingPanel).setVisibility(
									RelativeLayout.GONE);
						} catch (Exception e) {
							Log.e(SPLASH_TAG, "loading error", e);
						}
						allPlaces = response;

						Log.i(SPLASH_TAG, "Place size: " + allPlaces.size());

						/*
						 * Intent i = new Intent(SplashScreen.this,
						 * RegistrationActivity.class); startActivity(i);
						 */
						
						checkProfile();

					}
				});

		// -------end call to get places

	}// end onCreate()

	public static void checkProfile() {

		ProfileManager.checkProfileRegistration(appcontext,
				new ProfileInterface() {

					@Override
					public void checkRegistration(int registrationStatus) {

						Log.i(SPLASH_TAG, "registration status: "
								+ registrationStatus);
						userStatus = registrationStatus;

						switch (userStatus) {
						case -1:
							Intent i = new Intent(appcontext,
									RegistrationActivity.class);
							appcontext.startActivity(i);
							
							break;
						case 0:
							Intent i1 = new Intent(appcontext,
									VerificationActivity.class);
							appcontext.startActivity(i1);
							((Activity) appcontext).finish();

							break;
						case 1:
							Intent i2 = new Intent(appcontext,
									HomeActivity.class);
							appcontext.startActivity(i2);
							((Activity) appcontext).finish();

							break;

						default:
							break;
						}// End switch

					}// end checkRegistration()
				});// End checkProfileRegistration

		// -------end call to verify contact

	}
	
	//----end function

	public static ArrayList<Place> getAllPlaces() {
		return allPlaces;

	}
}// end Activity
